<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posture Test</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

    <style>
        /* Global Styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7fc;
            margin: 0;
            padding: 0;
        }

        .navbar {
            background-color: #0094FF;
        }

        .navbar-brand,
        .nav-link {
            color: white !important;
        }

        .navbar-light .navbar-nav .nav-link.active {
            color: #FFD700 !important;
        }

        .card {
            border-radius: 10px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            color: #0094FF;
        }

        .section-body {
            font-size: 1rem;
            text-align: justify;
            margin-bottom: 30px;
            color: #333;
        }

        .media-label {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .upload-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .upload-box {
            width: 300px;
            height: 300px;
            border: 2px dashed #0d6efd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #ccc;
            cursor: pointer;
            position: relative;
            background-color: white;
        }

        .upload-box:hover {
            border-color: #0d6dfd93;
        }

        .upload-box input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .image-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px dashed #797979;
            border-radius: 10px;
        }

        .preview-image {
            width: 300px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            border: 1px solid dotted;
        }

        .remove-btn {
            position: absolute;
            top: -6px;
            right: -6px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 14px;
            line-height: 18px;
            padding: 0;
        }

        .tip-card-title {
            font-size: 1.25rem;
            color: #0094FF;
        }

        .tip-card-body {
            color: #555;
        }

        .btn-primary {
            background-color: #0094FF;
            border-color: #0094FF;
            color: white;
        }

        .btn-primary:hover {
            background-color: #007bb5;
            border-color: #007bb5;
        }

        .footer {
            background-color: #0094FF;
            color: white;
            padding: 20px 0;
            text-align: center;
        }

        /* Media Query for Responsiveness */
        @media (max-width: 768px) {
            .upload-box {
                width: 250px;
                height: 250px;
            }
        }
    </style>

</head>

<body>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">POSTURE TESTER</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <!-- <a class="nav-link active" aria-current="page" href="#">Home</a> -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Introduction Section -->
    <div class="container my-5">
        <h2 class="section-header">Why Good Posture Matters</h2>
        <p class="section-body">Maintaining good posture is essential for overall health and well-being. Poor posture
            can
            lead to back pain, fatigue, and other issues. Whether sitting or standing, it's important to maintain proper
            alignment to reduce strain on your muscles and joints. Take the test now to assess your posture!</p>
    </div>

    <!-- Posture Test Section -->
    <!-- <div class="w-100 d-flex m-auto justify-content-center align-center">
        <div class="card m-auto" style="width: 40rem;">
            <div class="card-body">
                <div class="row">
                    <div class="media-label card-title text-center h1 fs-5">Test Your Posture!</div>

                    <div class="upload-container" id="preview-container">
                        <label class="upload-box" id="upload-btn">
                            +
                            <input type="file" multiple accept="image/*" onchange="previewFiles(event)" id="fileInput">
                        </label>
                    </div>

                    <div class="img_details p-5 d-none">
                        <div class="posture_type h1 text-center"></div>
                        <div class="retting text-center h3 p-3"></div>
                        <div class="feedback h5 text-center"></div>
                    </div>

                    <button class="btn btn-primary m-auto w-50 mt-5" id="submitBtn">
                        <span class="indicator-label">TEST</span>
                        <span class="indicator-progress d-none">Please wait...
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                </div>
            </div>
        </div>
    </div> -->

    <div class="w-100 d-flex m-auto justify-content-center align-center">

        <div class="card m-auto" style="width: 40rem;">
            <div class="card-body ">
                <div class="row">
                    <div class="media-label card-title text-center h1 fs-5">Test Your Posture!</div>
                    <div class="upload-container" id="preview-container">
                        <label class="upload-box" id="upload-btn">
                            +
                            <input type="file" multiple accept="image/*" onchange="previewFiles(event)" id="fileInput">
                        </label>
                    </div>

                    <div class="img_details p-5 d-none">
                        <div class="posture_type h1 text-center"></div>
                        <div class="retting text-center h3 p-3"></div>
                        <div class="feedback h5 text-center"></div>
                    </div>

                    <button class="btn btn-primary m-auto w-50 mt-5" id="submitBtn">
                        <span class="indicator-label">TEST</span>
                        <span class="indicator-progress d-none">Please wait...
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>

                </div>
            </div>
        </div>

    </div>

    <!-- Sitting Posture Section -->
    <div class="container my-5">
        <h2 class="section-header">Tips for Sitting Posture</h2>
        <div class="row">
            <div class="col-md-4">
                <div class="posture-tip-card">
                    <div class="tip-card-title">1. Sit Back in Your Chair</div>
                    <div class="tip-card-body">
                        Ensure that your back is fully supported by your chair, with your spine in a neutral position.
                        Avoid slouching or leaning forward.
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="posture-tip-card">
                    <div class="tip-card-title">2. Keep Feet Flat on the Ground</div>
                    <div class="tip-card-body">
                        Place your feet flat on the ground (or on a footrest) with your knees at a 90-degree angle. This
                        will help
                        reduce strain on your lower back.
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="posture-tip-card">
                    <div class="tip-card-title">3. Align Your Screen with Your Eyes</div>
                    <div class="tip-card-body">
                        Your computer screen should be at eye level so you don’t have to bend your neck or back. This
                        ensures
                        you maintain a comfortable sitting position for long periods.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="footer">
        <p>&copy; 2025 Posture Test. All Rights Reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const submitBtn = document.getElementById('submitBtn');
        const imgDetails = document.querySelector('.img_details');
        const indicatorProgress = submitBtn.querySelector('.indicator-progress');
        const indicatorLabel = submitBtn.querySelector('.indicator-label');

        async function getData() {
            const input = document.getElementById('fileInput');
            const formData = new FormData();

            submitBtn.disabled = true;
            indicatorLabel.classList.add('d-none');
            indicatorProgress.classList.add('d-block');
            indicatorProgress.classList.remove('d-none');

            if (input.files.length === 0) {
                alert('No file selected');
                indicatorLabel.classList.add('d-block');
                indicatorLabel.classList.remove('d-none');
                indicatorProgress.classList.add('d-none');
                indicatorProgress.classList.remove('d-block');
                submitBtn.disabled = false;
                return;
            }

            formData.append('files', input.files[0]);

            const url = "http://127.0.0.1:5000/api/detect";

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData,
                });

                const json = await response.json();

                if (json.status == 0) {
                    alert(json.msg);
                    indicatorLabel.classList.add('d-block');
                    indicatorLabel.classList.remove('d-none');
                    indicatorProgress.classList.add('d-none');
                    indicatorProgress.classList.remove('d-block');
                    submitBtn.disabled = false;
                    return;
                }

                indicatorLabel.classList.add('d-block');
                indicatorLabel.classList.remove('d-none');
                indicatorProgress.classList.add('d-none');
                indicatorProgress.classList.remove('d-block');
                submitBtn.classList.add('d-none');
                submitBtn.disabled = false;


                document.getElementsByClassName('posture_type')[0].innerHTML = json.posture_class;
                document.getElementsByClassName('feedback')[0].innerHTML = json.feedback;

                const rating = json.posture_rating;

                let stars = '';
                for (let i = 0; i < 10; i++) {
                    if (rating > i) {
                        stars += `<i class="fa-solid fa-star" style="color : #e9b900;"></i>`;
                    } else {
                        stars += `<i class="fa-regular fa-star" style="color : #bbbbbb;"></i>`;
                    }
                }

                document.getElementsByClassName('retting')[0].innerHTML = stars;
                imgDetails.classList.add('d-block');
                imgDetails.classList.remove('d-none');

                console.log('Server response:', json);

            } catch (error) {
                console.error('Error:', error.message);
                console.log(error);

                throw new Error(`Failed with status: ${response.status}`);

            }
        }

        submitBtn.addEventListener('click', async function () {
            await getData();
        });


        function previewFiles(event) {
            const files = event.target.files;
            const container = document.getElementById('preview-container');
            const uploadBtn = document.getElementById('upload-btn');

            uploadBtn.style.display = 'none';

            for (const file of files) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const wrapper = document.createElement("div");
                    wrapper.className = "image-wrapper";

                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.className = "preview-image";

                    const removeBtn = document.createElement("button");
                    removeBtn.textContent = "×";
                    removeBtn.className = "remove-btn";
                    removeBtn.onclick = function () {
                        uploadBtn.style.display = 'flex';
                        wrapper.remove();
                        document.getElementById('fileInput').value = '';
                        submitBtn.classList.add('d-block');
                        submitBtn.classList.remove('d-none');
                        imgDetails.classList.add('d-none');
                        imgDetails.classList.remove('d-block');
                    };

                    wrapper.appendChild(img);
                    wrapper.appendChild(removeBtn);
                    container.appendChild(wrapper);
                };
                reader.readAsDataURL(file);
            }
        }
    </script>

</body>

</html>